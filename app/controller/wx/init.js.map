{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\controller\\wx\\init.js"
    ],
    "names": [
        "Base",
        "require",
        "appid",
        "secret",
        "ticketUrl",
        "jsapi_ticket",
        "cache_duration",
        "request",
        "comm",
        "sha1",
        "cache",
        "module",
        "exports",
        "indexAction",
        "date_s",
        "ctx",
        "query",
        "xsd_sd",
        "sd_us",
        "sd_drtsae",
        "get",
        "kh_sd",
        "hc",
        "ssd_er",
        "getaccess_token",
        "ssde",
        "getconfig",
        "put",
        "json",
        "qiurl",
        "Promise",
        "resolve",
        "reject",
        "console",
        "log",
        "error",
        "resp",
        "ticketMap",
        "JSON",
        "parse",
        "jsapi",
        "access_token",
        "jsoner",
        "token_oe",
        "ticket",
        "url",
        "sd_jh",
        "appId",
        "nonceStr",
        "randomString",
        "timestamp",
        "Math",
        "floor",
        "Date",
        "now",
        "signature"
    ],
    "mappings": ";;AAAA,MAAMA,OAAOC,QAAQ,YAAR,CAAb;AACA,IAAIC,QAAQ,oBAAZ;AAAA,IACIC,SAAS,kCADb;AAAA,IAEIC,YAAY,yCAFhB;AAAA,IAGIC,eAAe,mDAHnB;AAAA,IAIIC,iBAAiB,OAAO,EAAP,GAAY,EAAZ,GAAiB,CAJtC,C,CAIyC;AACzC,IAAIC,UAAUN,QAAQ,SAAR,CAAd;AACA,MAAMO,OAAOP,QAAQ,sBAAR,CAAb;AACA,IAAIQ,OAAOR,QAAQ,MAAR,CAAX;AACA,IAAIS,QAAQT,QAAQ,cAAR,CAAZ;AACAU,OAAOC,OAAP,GAAiB,cAAcZ,IAAd,CAAmB;AAC1Ba,eAAN,GAAoB;AAAA;;AAAA;AAChB,gBAAIC,SAAS,MAAKC,GAAL,CAASC,KAAtB;AACA,gBAAIC,SAASH,OAAOI,KAApB;AAAA,gBACIC,YAAY,EADhB;AAEA,gBAAIT,MAAMU,GAAN,CAAU,QAAV,CAAJ,EAAyB;AACrBD,4BAAY,MAAKE,KAAL,CAAWX,MAAMU,GAAN,CAAU,QAAV,CAAX,EAAgCH,MAAhC,CAAZ;AACAE,0BAAUG,EAAV,GAAe,IAAf;AACH,aAHD,MAGO;AACH,oBAAIC,SAAS,MAAM,MAAKC,eAAL,EAAnB;AACA,oBAAIC,OAAO,MAAM,MAAKC,SAAL,CAAeH,MAAf,CAAjB;AACAb,sBAAMiB,GAAN,CAAU,QAAV,EAAoBF,IAApB,EAA0BnB,cAA1B,EAHG,CAGwC;AAC3Ca,4BAAY,MAAKE,KAAL,CAAWI,IAAX,EAAiBR,MAAjB,CAAZ;AACAE,0BAAUG,EAAV,GAAe,KAAf;AACH;AACD,mBAAO,MAAKM,IAAL,CAAUT,SAAV,CAAP;AAdgB;AAenB;AACDK,sBAAkB;AAAE;AAChB,YAAIK,QAAQzB,YAAa,uCAAsCF,KAAM,WAAUC,MAAO,EAAtF;AACA,eAAO,IAAI2B,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpCC,oBAAQC,GAAR,CAAYL,KAAZ;AACAtB,oBAAQsB,KAAR,EAAe,UAAUM,KAAV,EAAiBC,IAAjB,EAAuBR,IAAvB,EAA6B;AACxC,oBAAIS,YAAYC,KAAKC,KAAL,CAAWX,IAAX,CAAhB;AACA,oBAAIY,QAAQnC,eAAe,2BAAf,GAA6CgC,UAAUI,YAAnE;AACAR,wBAAQC,GAAR,CAAYN,IAAZ;AACAG,wBAAQS,KAAR;AACH,aALD;AAMH,SARM,CAAP;AASH;AACDd,cAAUc,KAAV,EAAiB;AACb,eAAO,IAAIV,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpCzB,oBAAQiC,KAAR,EAAe,UAAUL,KAAV,EAAiBC,IAAjB,EAAuBM,MAAvB,EAA+B;AAC1C,oBAAIC,WAAWL,KAAKC,KAAL,CAAWG,MAAX,CAAf;AACAX,wBAAQY,SAASC,MAAjB;AACH,aAHD;AAIH,SALM,CAAP;AAMH;AACDvB,UAAMuB,MAAN,EAAcC,GAAd,EAAmB;AACf,YAAIC,QAAQ,EAAZ;AACAA,cAAMC,KAAN,GAAc7C,KAAd;AACA4C,cAAME,QAAN,GAAiBxC,KAAKyC,YAAL,EAAjB;AACAH,cAAMI,SAAN,GAAkBC,KAAKC,KAAL,CAAWC,KAAKC,GAAL,KAAa,IAAxB,CAAlB,CAJe,CAIiC;AAChDR,cAAMzC,YAAN,GAAqBuC,MAArB;AACAE,cAAMS,SAAN,GAAkB9C,KAAK,kBAAkBmC,MAAlB,GAA2B,YAA3B,GAA0CE,MAAME,QAAhD,GAA2D,aAA3D,GAA2EF,MAAMI,SAAjF,GAA6F,OAA7F,GAAuGL,GAA5G,CAAlB;AACA,eAAOC,KAAP;AACH;;AA7C+B,CAApC",
    "file": "..\\..\\..\\src\\controller\\wx\\init.js",
    "sourcesContent": [
        "const Base = require('../base.js');\r\nvar appid = 'wxf8b0c920900b2663',\r\n    secret = '299c6ab8cf95731ea90f9d28e6b150ce',\r\n    ticketUrl = \"https://api.weixin.qq.com/cgi-bin/token\",\r\n    jsapi_ticket = \"http://api.weixin.qq.com/cgi-bin/ticket/getticket\",\r\n    cache_duration = 1000 * 60 * 60 * 2; //缓存时长为2小时\r\nvar request = require('request');\r\nconst comm = require('../../util/public.js');\r\nvar sha1 = require('sha1');\r\nvar cache = require('memory-cache');\r\nmodule.exports = class extends Base {\r\n    async indexAction() {\r\n        var date_s = this.ctx.query\r\n        var xsd_sd = date_s.sd_us,\r\n            sd_drtsae = ''\r\n        if (cache.get('ticket')) {\r\n            sd_drtsae = this.kh_sd(cache.get('ticket'), xsd_sd)\r\n            sd_drtsae.hc = true\r\n        } else {\r\n            let ssd_er = await this.getaccess_token()\r\n            let ssde = await this.getconfig(ssd_er)\r\n            cache.put('ticket', ssde, cache_duration); //加入缓存\r\n            sd_drtsae = this.kh_sd(ssde, xsd_sd)\r\n            sd_drtsae.hc = false\r\n        }\r\n        return this.json(sd_drtsae)\r\n    }\r\n    getaccess_token() { //获取token\r\n        var qiurl = ticketUrl + `?grant_type=client_credential&appid=${appid}&secret=${secret}`\r\n        return new Promise((resolve, reject) => {\r\n            console.log(qiurl);\r\n            request(qiurl, function (error, resp, json) {\r\n                var ticketMap = JSON.parse(json);\r\n                var jsapi = jsapi_ticket + \"?type=jsapi&access_token=\" + ticketMap.access_token\r\n                console.log(json)\r\n                resolve(jsapi)\r\n            })\r\n        })\r\n    }\r\n    getconfig(jsapi) {\r\n        return new Promise((resolve, reject) => {\r\n            request(jsapi, function (error, resp, jsoner) {\r\n                var token_oe = JSON.parse(jsoner)\r\n                resolve(token_oe.ticket)\r\n            })\r\n        })\r\n    }\r\n    kh_sd(ticket, url) {\r\n        var sd_jh = {}\r\n        sd_jh.appId = appid\r\n        sd_jh.nonceStr = comm.randomString()\r\n        sd_jh.timestamp = Math.floor(Date.now() / 1000) //精确到秒\r\n        sd_jh.jsapi_ticket = ticket\r\n        sd_jh.signature = sha1('jsapi_ticket=' + ticket + '&noncestr=' + sd_jh.nonceStr + '&timestamp=' + sd_jh.timestamp + '&url=' + url);\r\n        return sd_jh;\r\n    }\r\n\r\n}\r\n"
    ]
}