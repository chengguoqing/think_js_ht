{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\controller\\xiaochengxu\\shengchengma.js"
    ],
    "names": [
        "Base",
        "require",
        "request",
        "fs",
        "cache",
        "tengxun_sc",
        "module",
        "exports",
        "indexAction",
        "sd_dsf",
        "ctx",
        "query",
        "th",
        "sd_dse",
        "path",
        "id",
        "sd_der",
        "get_action",
        "JSON",
        "parse",
        "decryption",
        "data",
        "url_e_er",
        "get",
        "getqc_ma",
        "js_sdf",
        "gettoken",
        "fenmian",
        "spt",
        "split",
        "baioti_ert",
        "name",
        "jiage",
        "assign",
        "display",
        "Promise",
        "resolve",
        "reject",
        "wx_sdf",
        "wcf",
        "cache_duration",
        "url_sd",
        "appId",
        "secret",
        "error",
        "resp",
        "json",
        "access_token",
        "put",
        "dekh",
        "file_name",
        "think",
        "uuid",
        "urk_dd",
        "sd_drer",
        "url",
        "method",
        "body",
        "stringify",
        "pipe",
        "createWriteStream",
        "sdsd_dse",
        "setTimeout",
        "a"
    ],
    "mappings": ";;AAAA,MAAMA,OAAOC,QAAQ,eAAR,CAAb;AACA,IAAIC,UAAUD,QAAQ,SAAR,CAAd;AACA,IAAIE,KAAKF,QAAQ,IAAR,CAAT;AACA,IAAIG,QAAQH,QAAQ,cAAR,CAAZ;AACA,MAAMI,aAAaJ,QAAQ,0BAAR,CAAnB;;AAEA;AACAK,OAAOC,OAAP,GAAiB,cAAcP,IAAd,CAAmB;AAC1BQ,eAAN,GAAoB;AAAA;;AAAA;AAChB,gBAAIC,SAAO,MAAKC,GAAL,CAASC,KAApB;;AAEA,gBAAIC,UAAJ;AACA,gBAAIC,SAAS;AACTC,sBAAK,gCAA8BL,OAAOM;AADjC,aAAb;AAGA,gBAAKC,SAAS,MAAM,MAAKC,UAAL,CAAgB,MAAhB,EAAwB,EAACF,IAAGN,OAAOM,EAAX,EAAxB,CAApB;AACGC,qBAASE,KAAKC,KAAL,CAAW,MAAKC,UAAL,CAAgBJ,OAAOK,IAAvB,CAAX,CAAT;;AAGH,gBAAIC,WAAW,EAAf;AACA,gBAAIlB,MAAMmB,GAAN,CAAU,YAAV,CAAJ,EAA6B;AACzBD,2BAAW,MAAM,MAAKE,QAAL,CAAcX,MAAd,EAAsBT,MAAMmB,GAAN,CAAU,YAAV,CAAtB,CAAjB;AACH,aAFD,MAEO;AACH,oBAAIE,SAAS,MAAM,MAAKC,QAAL,EAAnB;AACAJ,2BAAW,MAAM,MAAKE,QAAL,CAAcX,MAAd,EAAsBY,MAAtB,CAAjB;AACH;;AAEDH,qBAASK,OAAT,GAAiBX,OAAOY,GAAP,CAAWC,KAAX,CAAiB,GAAjB,EAAsB,CAAtB,CAAjB;AACAP,qBAASQ,UAAT,GAAoBd,OAAOe,IAA3B;AACAT,qBAASU,KAAT,GAAehB,OAAOgB,KAAtB;AACA,kBAAKC,MAAL,CAAYX,QAAZ;AACA,mBAAO,MAAKY,OAAL,EAAP;AAvBgB;AAyBnB;;AAEDR,eAAW;AACP,eAAO,IAAIS,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,gBAAIC,SAAS,KAAKC,GAAL,EAAb;AACA,gBAAIC,iBAAiB,OAAO,EAAP,GAAY,EAAZ,GAAiB,CAAtC,CAFoC,CAEI;AACxC,gBAAIC,SAAS,gFAAgFH,OAAOI,KAAvF,GAA+F,UAA/F,GAA4GJ,OAAOK,MAAhI;AACAzC,oBAAQuC,MAAR,EAAgB,UAAUG,KAAV,EAAiBC,IAAjB,EAAuBC,IAAvB,EAA6B;AACzCA,uBAAO5B,KAAKC,KAAL,CAAW2B,IAAX,EAAiBC,YAAxB;AACA3C,sBAAM4C,GAAN,CAAU,YAAV,EAAwBF,IAAxB,EAA8BN,cAA9B;;AAEAJ,wBAAQU,IAAR;AAEH,aAND;AAOH,SAXM,CAAP;AAaH;;AAEDtB,aAASyB,IAAT,EAAeF,YAAf,EAA6B;AACzB,eAAO,IAAIZ,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACpC,gBAAII,SAAS,2DAA2DM,YAAxE;AAAA,gBACIG,YAAYC,MAAMC,IAAN,KAAe,MAD/B;AAAA,gBAEIC,SAAS,YAAYH,SAFzB;AAGA,gBAAII,UAAUpD,QAAQ;AAClBqD,qBAAKd,MADa;AAElBe,wBAAQ,MAFU;AAGlBC,sBAAMvC,KAAKwC,SAAL,CAAeT,IAAf;AAHY,aAAR,EAIXU,IAJW,CAINxD,GAAGyD,iBAAH,CAAqB,gBAAgBP,MAArC,CAJM,CAAd;AAKA,gBAAIQ,WAAW,EAAf;AACAA,qBAASX,SAAT,GAAqBA,SAArB;AACAW,qBAASR,MAAT,GAAkBA,MAAlB;AACAS,uBAAWC,KAAK;AACZ3B,wBAAQyB,QAAR;AACH,aAFD,EAEG,IAFH;AAGH,SAfM,CAAP;AAgBH;AA7D+B,CAApC",
    "file": "..\\..\\..\\src\\controller\\xiaochengxu\\shengchengma.js",
    "sourcesContent": [
        "const Base = require('../base_nb.js');\r\nvar request = require('request');\r\nvar fs = require('fs');\r\nvar cache = require('memory-cache')\r\nconst tengxun_sc = require('../../util/tengxun_sc.js');\r\n\r\n//生成小程序码\r\nmodule.exports = class extends Base {\r\n    async indexAction() {\r\n        var sd_dsf=this.ctx.query\r\n\r\n        var th = this\r\n        var sd_dse = {\r\n            path:\"/pages/xiangqing/index?gid=\"+sd_dsf.id\r\n        }\r\n        var  sd_der = await this.get_action('spxq', {id:sd_dsf.id})\r\n           sd_der = JSON.parse(this.decryption(sd_der.data))\r\n\r\n        \r\n        var url_e_er = {}\r\n        if (cache.get('access_toe')) {\r\n            url_e_er = await this.getqc_ma(sd_dse, cache.get('access_toe'))\r\n        } else {\r\n            var js_sdf = await this.gettoken()\r\n            url_e_er = await this.getqc_ma(sd_dse, js_sdf)\r\n        }\r\n      \r\n        url_e_er.fenmian=sd_der.spt.split(\",\")[0]\r\n        url_e_er.baioti_ert=sd_der.name\r\n        url_e_er.jiage=sd_der.jiage\r\n        this.assign(url_e_er);\r\n        return this.display();\r\n\r\n    }\r\n\r\n    gettoken() {\r\n        return new Promise((resolve, reject) => {\r\n            var wx_sdf = this.wcf()\r\n            var cache_duration = 1000 * 60 * 60 * 2 //缓存时长为2小时\r\n            var url_sd = \"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=\" + wx_sdf.appId + \"&secret=\" + wx_sdf.secret\r\n            request(url_sd, function (error, resp, json) {\r\n                json = JSON.parse(json).access_token\r\n                cache.put('access_toe', json, cache_duration);\r\n\r\n                resolve(json)\r\n\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    getqc_ma(dekh, access_token) {\r\n        return new Promise((resolve, reject) => {\r\n            let url_sd = \"https://api.weixin.qq.com/wxa/getwxacode?access_token=\" + access_token,\r\n                file_name = think.uuid() + \".png\",\r\n                urk_dd = \"updata/\" + file_name\r\n            var sd_drer = request({\r\n                url: url_sd,\r\n                method: 'post',\r\n                body: JSON.stringify(dekh)\r\n            }).pipe(fs.createWriteStream('www/static/' + urk_dd))\r\n            let sdsd_dse = {}\r\n            sdsd_dse.file_name = file_name\r\n            sdsd_dse.urk_dd = urk_dd\r\n            setTimeout(a => {\r\n                resolve(sdsd_dse)\r\n            }, 1000);\r\n        })\r\n    }\r\n};\r\n"
    ]
}