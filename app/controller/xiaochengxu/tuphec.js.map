{
    "version": 3,
    "sources": [
        "..\\..\\..\\src\\controller\\xiaochengxu\\tuphec.js"
    ],
    "names": [
        "Base",
        "require",
        "cache",
        "tengxun_sc",
        "fs",
        "request",
        "createCanvas",
        "loadImage",
        "Image",
        "Canvas",
        "gm",
        "subClass",
        "imageMagick",
        "module",
        "exports",
        "indexAction",
        "date_s",
        "ctx",
        "post",
        "sd_dsf",
        "JSON",
        "parse",
        "decryption",
        "token",
        "sd_dse",
        "path",
        "id",
        "sd_der",
        "get_action",
        "data",
        "url_e_er",
        "get",
        "getqc_ma",
        "js_sdf",
        "gettoken",
        "fenmian",
        "spt",
        "split",
        "baioti_ert",
        "name",
        "jiage",
        "toFixed",
        "sdf_dff",
        "substring",
        "length",
        "img_er",
        "canvas",
        "getContext",
        "fillStyle",
        "fillRect",
        "myimg",
        "drawImage",
        "font",
        "fillText",
        "onload",
        "src",
        "urk_dd",
        "sd_er",
        "sd_dseert",
        "toBuffer",
        "quality",
        "img_e",
        "test_san",
        "think",
        "uuid",
        "sd_ddf",
        "code",
        "msg",
        "encryption",
        "stringify",
        "assign",
        "fail",
        "Promise",
        "resolve",
        "reject",
        "wx_sdf",
        "wcf",
        "cache_duration",
        "url_sd",
        "appId",
        "secret",
        "error",
        "resp",
        "json",
        "access_token",
        "put",
        "dekh",
        "file_name",
        "sd_eertt",
        "url",
        "method",
        "body",
        "pipe",
        "createWriteStream",
        "sdsd_dse",
        "setTimeout",
        "a"
    ],
    "mappings": "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",
    "file": "..\\..\\..\\src\\controller\\xiaochengxu\\tuphec.js",
    "sourcesContent": [
        "const Base = require('../base_nb.js');\r\nvar cache = require('memory-cache')\r\nconst tengxun_sc = require('../../util/tengxun_sc.js');\r\nvar fs = require('fs');\r\nvar request = require('request');\r\nconst {\r\n    createCanvas,\r\n    loadImage,\r\n    Image\r\n} = require('canvas')\r\n\r\nvar Canvas = require('canvas')\r\nvar gm = require('gm').subClass({\r\n    imageMagick: true\r\n}) // 注意使用的区别\r\n//图片合成\r\nmodule.exports = class extends Base {\r\n    async indexAction() {\r\n       var date_s = this.ctx.post()\r\n       var sd_dsf = JSON.parse(this.decryption(date_s.token))\r\n//       var  sd_dsf = {\r\n//            id: 2\r\n//        }\r\n\r\n        var sd_dse = {\r\n            path: \"/pages/xiangqing/main?id=\" + sd_dsf.id\r\n        }\r\n        var sd_der = await this.get_action('spxq', {\r\n            id: sd_dsf.id\r\n        })\r\n        sd_der = JSON.parse(this.decryption(sd_der.data))\r\n        var url_e_er = {}\r\n        if (cache.get('access_toe')) {\r\n            url_e_er = await this.getqc_ma(sd_dse, cache.get('access_toe'))\r\n        } else {\r\n            var js_sdf = await this.gettoken()\r\n            url_e_er = await this.getqc_ma(sd_dse, js_sdf)\r\n        }\r\n        var fenmian = sd_der.spt.split(\",\")[0],\r\n            baioti_ert = sd_der.name,\r\n            jiage = sd_der.jiage.toFixed(2)\r\n        var sdf_dff = baioti_ert.substring(0, 20) + \"\\n\" + baioti_ert.substring(20, baioti_ert.length)\r\n\r\n        const img_er = new Image()\r\n        const canvas = createCanvas(375, 610)\r\n        const ctx = canvas.getContext('2d')\r\n        ctx.fillStyle = '#fff';\r\n        ctx.fillRect(0, 0, 375, 610);\r\n        const myimg = await loadImage(fenmian) //放网络图片\r\n        ctx.drawImage(myimg, 10, 20, 355, 320)\r\n        ctx.fillStyle = \"#333\";\r\n        ctx.font = '18px Microsoft YaHei'\r\n        ctx.fillText(sdf_dff, 10, 375)\r\n        ctx.font = '16px Microsoft YaHei'\r\n        ctx.fillStyle = \"red\";\r\n        ctx.fillText('￥', 10, 480)\r\n        ctx.font = '28px Microsoft YaHei'\r\n        ctx.fillStyle = \"red\";\r\n        ctx.fillText(jiage, 25, 480)\r\n        img_er.onload = () => ctx.drawImage(img_er, 285, 435, 75, 75)\r\n        img_er.src = url_e_er.urk_dd\r\n        ctx.font = '10px Microsoft YaHei'\r\n        ctx.fillStyle = \"#999\";\r\n        ctx.fillText('扫描或长按小程序码', 275, 525)\r\n        var sd_er = {}\r\n      var sd_dseert = await canvas.toBuffer('image/jpeg', { quality: 1 })\r\n        sd_er.img_e= await tengxun_sc.test_san(think.uuid() + \".jpg\",sd_dseert)\r\n        var sd_ddf = {}\r\n        sd_ddf.code = 0\r\n        sd_ddf.msg = \"success\"\r\n        sd_ddf.data = this.encryption(JSON.stringify(sd_er))\r\n        this.assign(sd_er);\r\n        //return this.display();\r\n\r\n           return this.fail(sd_ddf); //2输出json 推荐\r\n    }\r\n\r\n\r\n    gettoken() {\r\n        return new Promise((resolve, reject) => {\r\n            var wx_sdf = this.wcf()\r\n            var cache_duration = 1000 * 60 * 60 * 2 //缓存时长为2小时\r\n            var url_sd = \"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=\" + wx_sdf.appId + \"&secret=\" + wx_sdf.secret\r\n            request(url_sd, function (error, resp, json) {\r\n                json = JSON.parse(json).access_token\r\n                cache.put('access_toe', json, cache_duration);\r\n                resolve(json)\r\n            })\r\n        })\r\n\r\n    }\r\n\r\n    getqc_ma(dekh, access_token) {\r\n        return new Promise((resolve, reject) => {\r\n            let url_sd = \"https://api.weixin.qq.com/wxa/getwxacode?access_token=\" + access_token,\r\n                file_name = think.uuid() + \".png\",\r\n                urk_dd = \"runtime/upload/\" + file_name\r\n            var sd_eertt = request({\r\n                url: url_sd,\r\n                method: 'post',\r\n                body: JSON.stringify(dekh)\r\n            }).pipe(fs.createWriteStream(urk_dd))\r\n\r\n            let sdsd_dse = {}\r\n            sdsd_dse.file_name = file_name\r\n            sdsd_dse.urk_dd = urk_dd\r\n            setTimeout(a => {\r\n                resolve(sdsd_dse)\r\n            }, 1000);\r\n        })\r\n    }\r\n\r\n\r\n};\r\n"
    ]
}