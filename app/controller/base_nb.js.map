{
    "version": 3,
    "sources": [
        "..\\..\\src\\controller\\base_nb.js"
    ],
    "names": [
        "crypto",
        "require",
        "key",
        "xml2js",
        "module",
        "exports",
        "think",
        "Controller",
        "__before",
        "assign",
        "add_action",
        "m_eel",
        "cz_er",
        "leisd",
        "model",
        "jhde",
        "result",
        "type",
        "thenAdd",
        "add",
        "code",
        "msg",
        "xg_action",
        "where",
        "id",
        "update",
        "get_action",
        "data",
        "console",
        "log",
        "page",
        "name",
        "order",
        "countSelect",
        "user_name",
        "yema",
        "find",
        "JSON",
        "stringify",
        "sd_ddf",
        "encryption",
        "del_action",
        "affectedRows",
        "delete",
        "iv",
        "clearEncoding",
        "cipherEncoding",
        "cipherChunks",
        "cipher",
        "createCipheriv",
        "setAutoPadding",
        "push",
        "final",
        "join",
        "decryption",
        "decipher",
        "createDecipheriv",
        "randomString",
        "len",
        "$chars",
        "maxPos",
        "length",
        "pwd",
        "i",
        "charAt",
        "Math",
        "floor",
        "random",
        "randomString_wei",
        "Date",
        "getTime",
        "zx",
        "stringA",
        "Object",
        "keys",
        "s_sdfs",
        "map",
        "a",
        "substring",
        "buildXML",
        "json",
        "builder",
        "Builder",
        "buildObject",
        "wcf",
        "ssr_dr",
        "appId",
        "secret"
    ],
    "mappings": "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",
    "file": "..\\..\\src\\controller\\base_nb.js",
    "sourcesContent": [
        "//type=1 添加 2修改  3查看 4删除 \r\nvar crypto = require('crypto');\r\nvar key = \"duxinggongchengguoqingguangzoulg\"\r\nvar xml2js = require('xml2js');\r\n\r\nmodule.exports = class extends think.Controller {\r\n    __before() {\r\n\r\n            this.assign('base_url', 'https://duxinggj.com/www/static/');\r\n        //        if (this.ctx.url != \"/admin/loadin\" && !this.cookie('user_id')) {\r\n        //            return this.fail({\r\n        //                code: -1,\r\n        //                msg: \"登录过期请重新登录\"\r\n        //            }); //2输出json 推荐\r\n        //        }\r\n\r\n    }\r\n    // 调用示列 sd_der= await this.add_action('fenlei', date_s,{name:date_s.name})\r\n    async add_action(m_eel, cz_er, leisd) {\r\n        var model = this.model(m_eel);\r\n        var jhde = {}\r\n        var result = \"\"\r\n        delete cz_er.type\r\n        if (leisd) { //有条件的话就不能添加重复的\r\n            result = await model.thenAdd(cz_er, leisd);\r\n        } else {\r\n            result = await model.add(cz_er);\r\n        }\r\n        if (result.type == \"exist\") { //已存在\r\n            jhde.code = -1\r\n            jhde.msg = '添加失败，请勿重复添加'\r\n        } else {\r\n            jhde.code = 0\r\n            jhde.msg = '添加成功'\r\n        }\r\n        return jhde\r\n\r\n    }\r\n\r\n    async xg_action(m_eel, cz_er, leisd) {\r\n        var model = this.model(m_eel);\r\n        var jhde = {}\r\n        var result = \"\"\r\n        delete cz_er.type\r\n        result = await model.where({\r\n            id: cz_er.id\r\n        }).update(cz_er);\r\n        if (result.type == \"exist\") { //已存在\r\n            jhde.code = -1\r\n            jhde.msg = '修改失败'\r\n        } else {\r\n            jhde.code = 0\r\n            jhde.msg = '修改成功'\r\n        }\r\n        return jhde\r\n\r\n    }\r\n\r\n\r\n    // 调用示列  sd_der = await this.get_action('fenlei', date_s)\r\n    async get_action(m_eel, cz_er, leisd) {\r\n        var model = this.model(m_eel);\r\n        var jhde = {}\r\n        var data = \"\"\r\n        delete cz_er.type\r\n        console.log(cz_er);\r\n        if (cz_er.page && cz_er.name) { //有分页的查询 且有分页查询\r\n            data = await model.page(cz_er.page).order('id DESC').where({\r\n                name: ['like', `%${cz_er.name||\"\"}%`]\r\n            }).countSelect();\r\n        } else if (cz_er.page && cz_er.user_name) { //有分页的查询 且有分页查询\r\n            data = await model.page(cz_er.page).order('id DESC').where({\r\n                user_name: ['like', `%${cz_er.user_name||\"\"}%`]\r\n            }).countSelect();\r\n        } else if (cz_er.page) { //有分页的查询\r\n            data = await model.page(cz_er.page, cz_er.yema || 10).order('id DESC').countSelect();\r\n        } else if (cz_er.id) { //根据id查询的\r\n            data = await model.where({\r\n                id: cz_er.id\r\n            }).find();\r\n        }\r\n        console.log(JSON.stringify(cz_er));\r\n        var sd_ddf = {}\r\n        sd_ddf.code = 0\r\n        sd_ddf.msg = \"success\"\r\n        sd_ddf.data = this.encryption(JSON.stringify(data))\r\n        return sd_ddf\r\n    }\r\n\r\n    //    删除\r\n    async del_action(m_eel, cz_er) {\r\n        var model = this.model(m_eel);\r\n        delete cz_er.type\r\n        let affectedRows = await model.where({\r\n            id: cz_er.id\r\n        }).delete();\r\n        var jhde = {}\r\n        if (affectedRows == 1) {\r\n            jhde.code = 0\r\n            jhde.msg = \"删除成功\"\r\n        } else {\r\n            jhde.code = -1\r\n            jhde.msg = \"删除失败\"\r\n        }\r\n        return jhde; //2输出json 推荐\r\n    }\r\n    //加密\r\n    encryption(data, iv) {\r\n        iv = iv || \"\";\r\n        var clearEncoding = 'utf8';\r\n        var cipherEncoding = 'base64';\r\n        var cipherChunks = [];\r\n        var cipher = crypto.createCipheriv('aes-256-ecb', key, iv);\r\n        cipher.setAutoPadding(true);\r\n        cipherChunks.push(cipher.update(data, clearEncoding, cipherEncoding));\r\n        cipherChunks.push(cipher.final(cipherEncoding));\r\n        return cipherChunks.join('');\r\n    }\r\n\r\n\r\n    //解密\r\n    decryption(data, iv) {\r\n        if (!data) {\r\n            return \"\";\r\n        }\r\n        iv = iv || \"\";\r\n        var clearEncoding = 'utf8';\r\n        var cipherEncoding = 'base64';\r\n        var cipherChunks = [];\r\n        var decipher = crypto.createDecipheriv('aes-256-ecb', key, iv);\r\n        decipher.setAutoPadding(true);\r\n        cipherChunks.push(decipher.update(data, cipherEncoding, clearEncoding));\r\n        cipherChunks.push(decipher.final(clearEncoding));\r\n        return cipherChunks.join('');\r\n    }\r\n\r\n    //    随便机数\r\n    randomString(len) {\r\n        len = len || 32;\r\n        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678'; /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/\r\n        var maxPos = $chars.length;\r\n        var pwd = '';\r\n        for (var i = 0; i < len; i++) {\r\n            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\r\n        }\r\n        return pwd;\r\n    }\r\n     \r\n       //    随便机数\r\n    randomString_wei() {\r\n       var len = 8;\r\n        var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678'; /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/\r\n        var maxPos = $chars.length;\r\n        var pwd = '';\r\n        for (var i = 0; i < len; i++) {\r\n            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\r\n        }\r\n        pwd+=new Date().getTime()\r\n        return pwd;\r\n    }\r\n    \r\n    \r\n    zx(data) {\r\n        var stringA = Object.keys(data),\r\n            s_sdfs = \"\"\r\n        //    stringA.sort()\r\n        stringA.map(function (a) {\r\n            s_sdfs += \"&\" + a + \"=\" + data[a]\r\n        })\r\n        s_sdfs = s_sdfs.substring(1, s_sdfs.length)\r\n        return s_sdfs\r\n    }\r\n    buildXML(json) {\r\n        var builder = new xml2js.Builder();\r\n        return builder.buildObject(json);\r\n    };\r\n\r\n    wcf() {\r\n        var ssr_dr = {}\r\n        ssr_dr.appId = \"wx30f2eb708506f491\"\r\n        ssr_dr.secret = '189e0d0d1ccb64c1d81650f5782b1048'\r\n        return ssr_dr\r\n    }\r\n\r\n\r\n\r\n};\r\n"
    ]
}